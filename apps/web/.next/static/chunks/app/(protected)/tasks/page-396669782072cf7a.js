(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[749],{79:(e,r,t)=>{"use strict";t.d(r,{P:()=>i});var l=t(6127),a=t(6435),s=t(2069),n=t(8106),d=t(3392);function i(e){let{user:r}=(0,n.A)(),t=(0,l.useMemo)(()=>{if(!r)return null;let t=(0,a.rJ)(s.db,"tasks"),l=[(0,a._M)("userId","==",r.uid)];return(null==e?void 0:e.workspaceId)&&l.push((0,a._M)("workspaceId","==",e.workspaceId)),l.push((0,a.My)("dueDate","asc")),(null==e?void 0:e.limit)&&e.limit>0&&l.push((0,a.AB)(e.limit)),(0,a.P)(t,...l)},[r,null==e?void 0:e.workspaceId,null==e?void 0:e.limit]);return r?(0,d.G)(t):{data:[],loading:!1,error:null,refetch:()=>{}}}},1997:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>m});var l=t(4215),a=t(6127),s=t(663),n=t(6435),d=t(2069),i=t(79),o=t(8106),u=t(3392);function c(e){if(!e)return null;let r=new Date(e);return Number.isNaN(r.getTime())?null:n.Dc.fromDate(r)}var p=t(9196);let x=s.Ik({title:s.Yj().min(1,"Title is required"),status:s.KC([s.eu("todo"),s.eu("doing"),s.eu("done")]),workspaceId:s.Yj().optional(),dueDate:s.Yj().optional()});function m(){let{data:e,loading:r,error:t}=(0,i.P)(),{data:s}=function(){let{user:e}=(0,o.A)(),[r,t]=(0,a.useState)([]),[l,s]=(0,a.useState)(!!e),[i,u]=(0,a.useState)(null),[c,p]=(0,a.useState)(0);return(0,a.useEffect)(()=>{if(!e){t([]),s(!1),u(null);return}s(!0);let r=(0,n.P)((0,n.rJ)(d.db,"workspaces"),(0,n._M)("ownerId","==",e.uid)),l=(0,n.P)((0,n.rJ)(d.db,"workspaces"),(0,n._M)("members","array-contains",e.uid)),a=(0,n.aQ)(r,r=>{let l=r.docs.map(e=>({id:e.id,...e.data()}));t(r=>[...l,...r.filter(r=>r.ownerId!==e.uid)]),s(!1)},e=>{u(e),s(!1)}),i=(0,n.aQ)(l,r=>{let l=r.docs.map(e=>({id:e.id,...e.data()}));t(r=>{let t=r.filter(r=>r.ownerId===e.uid),a=new Map;return[...t,...l].forEach(e=>{e.id&&a.set(e.id,e)}),Array.from(a.values())}),s(!1)},e=>{u(e),s(!1)});return()=>{a(),i()}},[e,c]),{data:r,loading:l,error:i,refetch:()=>p(e=>e+1)}}(),{reminders:m,loading:b,error:h}=function(){let{user:e}=(0,o.A)(),r=(0,a.useMemo)(()=>{if(!e)return null;let r=(0,n.rJ)(d.db,"taskReminders"),t=[(0,n._M)("userId","==",e.uid)];return(0,n.P)(r,...t)},[null==e?void 0:e.uid]);if(!e)return{reminders:[],loading:!1,error:null,refetch:()=>{}};let{data:t,loading:l,error:s,refetch:i}=(0,u.G)(r);return{reminders:t,loading:l,error:s,refetch:i}}(),[g,f]=(0,a.useState)("all"),[v,j]=(0,a.useState)("all"),[k,N]=(0,a.useState)(""),[I,S]=(0,a.useState)("todo"),[y,E]=(0,a.useState)(""),[D,_]=(0,a.useState)(""),[w,C]=(0,a.useState)(!1),[A,T]=(0,a.useState)(null),[P,M]=(0,a.useState)(null),[U,B]=(0,a.useState)(null),[R,L]=(0,a.useState)(""),[O,F]=(0,a.useState)("todo"),[J,W]=(0,a.useState)(""),[X,G]=(0,a.useState)(""),[Y,H]=(0,a.useState)(!1),[K,q]=(0,a.useState)(null),[Q,V]=(0,a.useState)(null),[Z,z]=(0,a.useState)({}),[$,ee]=(0,a.useState)(null),[er,et]=(0,a.useState)(null),[el,ea]=(0,a.useState)(null),es=(0,p.useSearchParams)().get("taskId"),en=(0,a.useMemo)(()=>{let r=e;return"all"!==g&&(r=r.filter(e=>{var r;return(null!=(r=e.status)?r:"todo")===g})),"all"!==v&&(r=r.filter(e=>e.workspaceId===v)),r.slice().sort((e,r)=>{let t=e.dueDate?e.dueDate.toMillis():null,l=r.dueDate?r.dueDate.toMillis():null,a=null!==t,s=null!==l;if(a&&s)return t-l;if(a&&!s)return -1;if(!a&&s)return 1;let n=e.updatedAt?e.updatedAt.toMillis():0;return(r.updatedAt?r.updatedAt.toMillis():0)-n})},[e,g,v]),ed=async()=>{let e=d.j2.currentUser;if(!e)return void T("You must be signed in to create tasks.");T(null),M(null);let r=x.safeParse({title:k,status:I,workspaceId:y||void 0,dueDate:D||void 0});if(!r.success){var t,l;T(null!=(l=null==(t=r.error.issues[0])?void 0:t.message)?l:"Invalid task data.");return}let{title:a,status:s,workspaceId:i,dueDate:o}=r.data,u=o?c(o):null;C(!0);try{let r={userId:e.uid,title:a,status:s,workspaceId:null!=i?i:null,dueDate:u,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)()};await (0,n.gS)((0,n.rJ)(d.db,"tasks"),r),N(""),S("todo"),E(""),_(""),M("Task created.")}catch(e){console.error("Error creating task",e),T("Error creating task.")}finally{C(!1)}},ei=()=>{B(null),L(""),F("todo"),W(""),G(""),q(null)},eo=async e=>{if(!e.id)return;let r=d.j2.currentUser;if(!r||r.uid!==e.userId)return void q("Cannot update this task.");q(null);let t=x.safeParse({title:R,status:O,workspaceId:J||void 0,dueDate:X||void 0});if(!t.success){var l,a;q(null!=(a=null==(l=t.error.issues[0])?void 0:l.message)?a:"Invalid task data.");return}let{title:s,status:i,workspaceId:o,dueDate:u}=t.data,p=u?c(u):null;H(!0);try{await (0,n.mZ)((0,n.H9)(d.db,"tasks",e.id),{title:s,status:i,workspaceId:null!=o?o:null,dueDate:p,updatedAt:(0,n.O5)()}),ei()}catch(e){console.error("Error updating task",e),q("Error updating task.")}finally{H(!1)}},eu=async e=>{if(!e.id)return;let r=d.j2.currentUser;if(r&&r.uid===e.userId&&confirm("Delete this task?")){V(e.id);try{await (0,n.kd)((0,n.H9)(d.db,"tasks",e.id))}catch(e){console.error("Error deleting task",e)}finally{V(null)}}},ec=async e=>{var r;if(!e.id)return;let t=d.j2.currentUser;if(!t)return void et("You must be signed in to create reminders.");let l=null!=(r=Z[e.id])?r:"";if(!l)return void et("Please select a reminder time.");et(null),ee(e.id);try{let r=new Date(l);if(Number.isNaN(r.getTime())){et("Invalid reminder time."),ee(null);return}let a=r.toISOString(),s=e.dueDate?e.dueDate.toDate().toISOString():"";await (0,n.gS)((0,n.rJ)(d.db,"taskReminders"),{userId:t.uid,taskId:e.id,dueDate:s,reminderTime:a,sent:!1,createdAt:(0,n.O5)()}),z(r=>({...r,[e.id]:""}))}catch(e){console.error("Error creating reminder",e),et("Error creating reminder.")}finally{ee(null)}},ep=async e=>{if(!e.id)return;let r=d.j2.currentUser;if(r&&r.uid===e.userId&&confirm("Delete this reminder?")){ea(e.id);try{await (0,n.kd)((0,n.H9)(d.db,"taskReminders",e.id))}catch(e){console.error("Error deleting reminder",e)}finally{ea(null)}}},ex=x.safeParse({title:k,status:I,workspaceId:y||void 0,dueDate:D||void 0}).success;return(0,a.useEffect)(()=>{if(!es)return;let e=document.getElementById("task-".concat(es));e&&e.scrollIntoView({behavior:"smooth",block:"center"})},[es,en.length]),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("header",{className:"flex flex-col gap-2 mb-4",children:[(0,l.jsx)("h1",{className:"text-xl font-semibold",children:"Tasks"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{children:"Status:"}),(0,l.jsxs)("select",{value:g,onChange:e=>f(e.target.value),className:"border border-border rounded px-2 py-1 bg-background",children:[(0,l.jsx)("option",{value:"all",children:"All"}),(0,l.jsx)("option",{value:"todo",children:"Todo"}),(0,l.jsx)("option",{value:"doing",children:"Doing"}),(0,l.jsx)("option",{value:"done",children:"Done"})]})]}),(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{children:"Workspace:"}),(0,l.jsxs)("select",{value:v,onChange:e=>j(e.target.value),className:"border border-border rounded px-2 py-1 bg-background",children:[(0,l.jsx)("option",{value:"all",children:"All"}),s.map(e=>{var r,t;return(0,l.jsx)("option",{value:null!=(r=e.id)?r:"",children:e.name},null!=(t=e.id)?t:e.name)})]})]})]})]}),(0,l.jsxs)("section",{className:"space-y-2 border border-border rounded px-3 py-2",children:[(0,l.jsx)("h2",{className:"font-semibold",children:"New Task"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,l.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,l.jsx)("span",{children:"Title"}),(0,l.jsx)("input",{type:"text",value:k,onChange:e=>N(e.target.value),className:"border border-border rounded px-2 py-1 bg-background"})]}),(0,l.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,l.jsx)("span",{children:"Status"}),(0,l.jsxs)("select",{value:I,onChange:e=>S(e.target.value),className:"border border-border rounded px-2 py-1 bg-background",children:[(0,l.jsx)("option",{value:"todo",children:"Todo"}),(0,l.jsx)("option",{value:"doing",children:"Doing"}),(0,l.jsx)("option",{value:"done",children:"Done"})]})]}),(0,l.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,l.jsx)("span",{children:"Workspace"}),(0,l.jsxs)("select",{value:y,onChange:e=>E(e.target.value),className:"border border-border rounded px-2 py-1 bg-background",children:[(0,l.jsx)("option",{value:"",children:"—"}),s.map(e=>{var r,t;return(0,l.jsx)("option",{value:null!=(r=e.id)?r:"",children:e.name},null!=(t=e.id)?t:e.name)})]})]}),(0,l.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,l.jsx)("span",{children:"Due date"}),(0,l.jsx)("input",{type:"datetime-local",value:D,onChange:e=>_(e.target.value),className:"border border-border rounded px-2 py-1 bg-background"})]}),(0,l.jsx)("button",{type:"button",onClick:ed,disabled:w||!ex,className:"border border-border rounded px-3 py-1 bg-background",children:w?"Creating...":"Create"})]}),A&&(0,l.jsx)("p",{className:"text-sm",children:A}),P&&(0,l.jsx)("p",{className:"text-sm",children:P})]}),r&&(0,l.jsx)("p",{children:"Loading tasks..."}),t&&(0,l.jsx)("p",{children:"Error loading tasks."}),!r&&!t&&0===en.length&&(0,l.jsx)("p",{children:"No tasks yet."}),!r&&!t&&en.length>0&&(0,l.jsx)("ul",{className:"space-y-2",children:en.map(e=>{var r,t,a,n,d,i,o;let u=U===e.id,c=null!=(t=e.status)?t:"todo",p=null!=(a=null==(r=s.find(r=>r.id===e.workspaceId))?void 0:r.name)?a:"—",x=(o=null!=(n=e.dueDate)?n:null)?o.toDate().toLocaleString():"",g=m.filter(r=>r.taskId===e.id);return(0,l.jsxs)("li",{id:e.id?"task-".concat(e.id):void 0,className:"border rounded px-3 py-2 ".concat(e.id&&e.id===es?"border-primary":"border-border"),children:[!u&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"font-medium",children:e.title}),(0,l.jsxs)("div",{className:"text-sm text-muted-foreground flex flex-wrap gap-2",children:[(0,l.jsxs)("span",{children:["Status: ",c]}),(0,l.jsxs)("span",{children:["Workspace: ",p]}),x&&(0,l.jsxs)("span",{children:["Due: ",x]})]}),(0,l.jsxs)("div",{className:"mt-2 flex gap-2 text-sm",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{var r,t,l,a,s;B(null!=(r=e.id)?r:null),L(e.title),F(null!=(t=e.status)?t:"todo"),W(null!=(l=e.workspaceId)?l:""),G((s=null!=(a=e.dueDate)?a:null)?s.toDate().toISOString().slice(0,16):""),q(null)},className:"border border-border rounded px-2 py-1 bg-background",children:"Edit"}),(0,l.jsx)("button",{type:"button",onClick:()=>eu(e),disabled:Q===e.id,className:"border border-border rounded px-2 py-1 bg-background",children:Q===e.id?"Deleting...":"Delete"})]}),(0,l.jsxs)("div",{className:"mt-3 space-y-1 text-sm",children:[(0,l.jsx)("div",{className:"font-semibold",children:"Reminders"}),b&&(0,l.jsx)("p",{children:"Loading reminders..."}),h&&(0,l.jsx)("p",{children:"Error loading reminders."}),!b&&0===g.length&&(0,l.jsx)("p",{children:"No reminders."}),!b&&g.length>0&&(0,l.jsx)("ul",{className:"space-y-1",children:g.map(e=>(0,l.jsxs)("li",{className:"flex items-center gap-2",children:[(0,l.jsxs)("span",{children:[new Date(e.reminderTime).toLocaleString()," "," ",e.sent?"(sent)":"(pending)"]}),(0,l.jsx)("button",{type:"button",onClick:()=>ep(e),disabled:el===e.id,className:"border border-border rounded px-2 py-0.5 bg-background",children:el===e.id?"Deleting...":"Delete"})]},e.id))}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,l.jsx)("input",{type:"datetime-local",value:null!=(i=Z[null!=(d=e.id)?d:""])?i:"",onChange:r=>{var t,l,a;return l=null!=(t=e.id)?t:"",a=r.target.value,void z(e=>({...e,[l]:a}))},className:"border border-border rounded px-2 py-1 bg-background"}),(0,l.jsx)("button",{type:"button",onClick:()=>ec(e),disabled:$===e.id,className:"border border-border rounded px-2 py-1 bg-background",children:$===e.id?"Saving...":"Add reminder"})]}),er&&(0,l.jsx)("p",{className:"text-xs",children:er})]})]}),u&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 items-center text-sm",children:[(0,l.jsxs)("label",{className:"flex flex-col",children:[(0,l.jsx)("span",{children:"Title"}),(0,l.jsx)("input",{type:"text",value:R,onChange:e=>L(e.target.value),className:"border border-border rounded px-2 py-1 bg-background"})]}),(0,l.jsxs)("label",{className:"flex flex-col",children:[(0,l.jsx)("span",{children:"Status"}),(0,l.jsxs)("select",{value:O,onChange:e=>F(e.target.value),className:"border border-border rounded px-2 py-1 bg-background",children:[(0,l.jsx)("option",{value:"todo",children:"Todo"}),(0,l.jsx)("option",{value:"doing",children:"Doing"}),(0,l.jsx)("option",{value:"done",children:"Done"})]})]}),(0,l.jsxs)("label",{className:"flex flex-col",children:[(0,l.jsx)("span",{children:"Workspace"}),(0,l.jsxs)("select",{value:J,onChange:e=>W(e.target.value),className:"border border-border rounded px-2 py-1 bg-background",children:[(0,l.jsx)("option",{value:"",children:"—"}),s.map(e=>{var r,t;return(0,l.jsx)("option",{value:null!=(r=e.id)?r:"",children:e.name},null!=(t=e.id)?t:e.name)})]})]}),(0,l.jsxs)("label",{className:"flex flex-col",children:[(0,l.jsx)("span",{children:"Due date"}),(0,l.jsx)("input",{type:"datetime-local",value:X,onChange:e=>G(e.target.value),className:"border border-border rounded px-2 py-1 bg-background"})]})]}),(0,l.jsxs)("div",{className:"mt-2 flex gap-2 text-sm",children:[(0,l.jsx)("button",{type:"button",onClick:()=>eo(e),disabled:Y,className:"border border-border rounded px-2 py-1 bg-background",children:Y?"Saving...":"Save"}),(0,l.jsx)("button",{type:"button",onClick:ei,className:"border border-border rounded px-2 py-1 bg-background",children:"Cancel"})]}),K&&(0,l.jsx)("p",{className:"text-sm mt-1",children:K})]})]},e.id)})})]})}},2069:(e,r,t)=>{"use strict";let l,a,s,n;t.d(r,{db:()=>s,gw:()=>g,hg:()=>i.hg,j2:()=>a});var d=t(1869),i=t(3086),o=t(6435),u=t(6512),c=t(3668),p=t(5732),x=t(4536);let m={apiKey:x.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:x.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:x.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,appId:x.env.NEXT_PUBLIC_FIREBASE_APP_ID,messagingSenderId:x.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,measurementId:x.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID};if(!m.apiKey||!m.projectId||!m.appId)throw Error("Missing required Firebase environment variables");let b="true"===x.env.NEXT_PUBLIC_USE_EMULATORS,h=null;async function g(){return h||null}l=(0,d.Dk)().length?(0,d.Dk)()[0]:(0,d.Wp)(m),a=(0,i.xI)(l),s=(0,o.aU)(l),n=(0,u.c7)(l),b&&((0,i.Wq)(a,"http://localhost:9099",{disableWarnings:!0}),(0,o.vN)(s,"localhost",8080),(0,u.nb)(n,"localhost",9199)),h=(0,c.TT)().then(e=>e?(0,c.dG)(l):null),(0,p.TT)().then(e=>e?(0,p.P5)(l):null)},2339:(e,r,t)=>{Promise.resolve().then(t.bind(t,1997))},3392:(e,r,t)=>{"use strict";t.d(r,{G:()=>s});var l=t(6127),a=t(6435);function s(e){let[r,t]=(0,l.useState)([]),[s,n]=(0,l.useState)(!!e),[d,i]=(0,l.useState)(null),[o,u]=(0,l.useState)(0);return(0,l.useEffect)(()=>{if(!e){t([]),n(!1),i(null);return}n(!0);let r=(0,a.aQ)(e,e=>{t(e.docs.map(e=>({id:e.id,...e.data()}))),n(!1)},e=>{i(e),n(!1)});return()=>r()},[e,o]),{data:r,loading:s,error:d,refetch:()=>u(e=>e+1)}}},8106:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});var l=t(6127),a=t(2069);function s(){let[e,r]=(0,l.useState)(null),[t,s]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{let e=(0,a.hg)(a.j2,e=>{r(e),s(!1)});return()=>e()},[]),{user:e,loading:t}}}},e=>{e.O(0,[680,661,694,548,533,125,358],()=>e(e.s=2339)),_N_E=e.O()}]);