(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[736],{2069:(e,n,t)=>{"use strict";let r,s,i,a;t.d(n,{db:()=>i,gw:()=>g,hg:()=>o.hg,j2:()=>s});var l=t(1869),o=t(3086),d=t(6435),u=t(6512),c=t(3668),f=t(5732),m=t(4536);let h={apiKey:m.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:m.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:m.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,appId:m.env.NEXT_PUBLIC_FIREBASE_APP_ID,messagingSenderId:m.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,measurementId:m.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID};if(!h.apiKey||!h.projectId||!h.appId)throw Error("Missing required Firebase environment variables");let p="true"===m.env.NEXT_PUBLIC_USE_EMULATORS,E=null;async function g(){return E||null}r=(0,l.Dk)().length?(0,l.Dk)()[0]:(0,l.Wp)(h),s=(0,o.xI)(r),i=(0,d.aU)(r),a=(0,u.c7)(r),p&&((0,o.Wq)(s,"http://localhost:9099",{disableWarnings:!0}),(0,d.vN)(i,"localhost",8080),(0,u.nb)(a,"localhost",9199)),E=(0,c.TT)().then(e=>e?(0,c.dG)(r):null),(0,f.TT)().then(e=>e?(0,f.P5)(r):null)},4059:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>m});var r=t(4215),s=t(6127),i=t(6435),a=t(2069),l=t(8106),o=t(3668),d=t(4536);async function u(){return"Notification"in window?"granted"===Notification.permission?"granted":"denied"===Notification.permission?"denied":Notification.requestPermission():"denied"}async function c(){if("granted"!==await u())return null;let e=await (0,a.gw)();if(!e)return null;let n=d.env.NEXT_PUBLIC_FCM_VAPID_KEY;if(!n)return console.warn("NEXT_PUBLIC_FCM_VAPID_KEY is not set"),null;try{return await (0,o.gf)(e,{vapidKey:n})||null}catch(e){return console.error("Error retrieving FCM token",e),null}}async function f(){let e=a.j2.currentUser;if(!e)return void console.warn("User not authenticated, skipping FCM token registration");let n=await c();if(!n)return void console.warn("No FCM token retrieved");try{var t,r;let s=(0,i.H9)(a.db,"users",e.uid),l=await (0,i.x7)(s);if(!l.exists()){await (0,i.BN)(s,{uid:e.uid,email:null!=(t=e.email)?t:null,fcmTokens:{[n]:!0}},{merge:!0}),console.log("Registered FCM token for new user document ".concat(e.uid));return}if((null!=(r=l.data().fcmTokens)?r:{})[n])return void console.log("FCM token already registered for this user");await (0,i.mZ)(s,{["fcmTokens.".concat(n)]:!0}),console.log("Registered FCM token ".concat(n," for user ").concat(e.uid))}catch(e){console.error("Error registering FCM token in Firestore",e)}}function m(){var e,n;let{data:t,loading:o,error:d}=function(){let{user:e}=(0,l.A)(),[n,t]=(0,s.useState)(null),[r,o]=(0,s.useState)(!!e),[d,u]=(0,s.useState)(null),[c,f]=(0,s.useState)(0);return(0,s.useEffect)(()=>{if(!e){t(null),o(!1),u(null);return}o(!0);let n=(0,i.H9)(a.db,"users",e.uid),r=(0,i.aQ)(n,e=>{e.exists()?t({id:e.id,...e.data()}):t(null),o(!1)},e=>{u(e),o(!1)});return()=>r()},[e,c]),{data:n,loading:r,error:d,refetch:()=>f(e=>e+1)}}(),[u,c]=(0,s.useState)(!1),[m,h]=(0,s.useState)(null),[p,E]=(0,s.useState)(null),g=async()=>{var e,n;if(!t)return;let r=a.j2.currentUser;if(!r||r.uid!==t.uid)return void h("Cannot update settings for this user.");let s=!!(null==(n=t.settings)||null==(e=n.notifications)?void 0:e.taskReminders);c(!0),h(null);try{let e=(0,i.H9)(a.db,"users",r.uid);await (0,i.mZ)(e,{"settings.notifications.taskReminders":!s}),h("Task reminders updated.")}catch(e){console.error("Error updating task reminders",e),h("Error updating task reminders.")}finally{c(!1)}},_=async()=>{E("Enabling push notifications...");try{await f(),E("Push notifications enabled (if permission granted).")}catch(e){console.error("Error enabling push notifications",e),E("Error enabling push notifications.")}};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold",children:"Settings (read-only)"}),o&&(0,r.jsx)("p",{children:"Loading settings..."}),d&&(0,r.jsx)("p",{children:"Error loading settings."}),!o&&!d&&!t&&(0,r.jsx)("p",{children:"No settings found."}),!o&&!d&&t&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Display name:"})," ",(0,r.jsx)("span",{children:t.displayName||"—"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Email:"})," ",(0,r.jsx)("span",{children:t.email||"—"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Task reminders:"})," ",(0,r.jsx)("span",{children:(null==(n=t.settings)||null==(e=n.notifications)?void 0:e.taskReminders)?"Enabled":"Disabled"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("button",{type:"button",onClick:g,disabled:u,className:"border border-border rounded px-3 py-1 bg-background",children:u?"Updating...":"Toggle task reminders"}),m&&(0,r.jsx)("p",{className:"text-sm",children:m})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("button",{type:"button",onClick:_,className:"border border-border rounded px-3 py-1 bg-background",children:"Enable push notifications"}),p&&(0,r.jsx)("p",{className:"text-sm",children:p})]})]})]})}},8106:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var r=t(6127),s=t(2069);function i(){let[e,n]=(0,r.useState)(null),[t,i]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=(0,s.hg)(s.j2,e=>{n(e),i(!1)});return()=>e()},[]),{user:e,loading:t}}},9456:(e,n,t)=>{Promise.resolve().then(t.bind(t,4059))}},e=>{e.O(0,[680,661,694,533,125,358],()=>e(e.s=9456)),_N_E=e.O()}]);